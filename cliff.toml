# =============================================================================
# ER Save Manager - Git Cliff Configuration
# =============================================================================
#
# This file configures git-cliff for automatic changelog generation.
# Documentation: https://git-cliff.org/docs/configuration
#
# Conventional Commit Types:
#   feat:     New features (âœ¨ New Features)
#   fix:      Bug fixes (ğŸ”§ Bug Fixes)
#   ui/ux:    UI changes (ğŸ¨ User Interface)
#   docs:     Documentation (ğŸ“– Documentation)
#   perf:     Performance (âš¡ Performance Improvements)
#   refactor: Code refactoring (â™»ï¸ Code Refactoring)
#   test:     Tests (skipped)
#   ci:       CI/CD (skipped)
#   build:    Build system (skipped)
#   chore:    Maintenance (ğŸ§¹ Maintenance)
#   security: Security fixes (ğŸ”’ Security)
#   revert:   Reverted changes (âª Reverted Changes)
#
# =============================================================================

# -----------------------------------------------------------------------------
# Changelog Output Format
# -----------------------------------------------------------------------------
[changelog]
header = """
# ğŸ“œ ER Save Manager - Release History

> A comprehensive changelog for the Elden Ring Save Manager application.
> All notable changes to this project are documented here.

"""
body = """
{% if version -%}
## ğŸ“¦ Release {{ version | trim_start_matches(pat="v") }}
**Released:** {{ timestamp | date(format="%B %d, %Y") }}

{% else -%}
## ğŸš§ Unreleased Changes
**Status:** Development in progress

{% endif -%}
{% for group, commits in commits | group_by(attribute="group") %}
### {{ group | striptags | trim | upper_first }}

{% for commit in commits | unique(attribute="id") %}
{%- set pr_num = commit.remote.pr_number | default(value=0) -%}
{%- set short_id = commit.id | truncate(length=7, end="") -%}
- {{ commit.message | upper_first | trim }}{% if commit.scope %} `[{{ commit.scope }}]`{% endif %}{% if pr_num > 0 %} ([#{{ pr_num }}](https://github.com/Hapfel1/er-save-manager/pull/{{ pr_num }})){% endif %} ([{{ short_id }}](https://github.com/Hapfel1/er-save-manager/commit/{{ commit.id }})){% if commit.breaking %} âš ï¸ **BREAKING CHANGE**{% endif %}

{% endfor %}
{% endfor %}
---

"""
footer = """
{%- macro repo_url() -%}
https://github.com/Hapfel1/er-save-manager
{%- endmacro -%}

{% for release in releases -%}
    {% if release.version -%}
        {% if release.previous.version -%}
[{{ release.version | trim_start_matches(pat="v") }}]: {{ self::repo_url() }}/compare/{{ release.previous.version }}..{{ release.version }}
        {% endif -%}
    {% else -%}
[unreleased]: {{ self::repo_url() }}/compare/{{ release.previous.version }}..HEAD
    {% endif -%}
{% endfor %}
"""
trim = true
render_always = true

# -----------------------------------------------------------------------------
# Git Configuration
# -----------------------------------------------------------------------------
[git]
conventional_commits = true
filter_unconventional = false
split_commits = false
# Match both versioned tags (1.x.x) and v-prefixed tags (v1.x.x)
tag_pattern = "v?[0-9]+\\.[0-9]+\\.[0-9]+"

# -----------------------------------------------------------------------------
# Commit Preprocessors
# -----------------------------------------------------------------------------
# Auto-fix common non-conventional commit formats to conventional format
commit_preprocessors = [
  { pattern = "^Fix ", replace = "fix: " },
  { pattern = "^Add ", replace = "feat: " },
  { pattern = "^Update ", replace = "chore: " },
]

# -----------------------------------------------------------------------------
# Commit Parsers
# -----------------------------------------------------------------------------
# Define how commits are categorized into changelog sections

commit_parsers = [
  # Skip merge commits
  { message = "^Merge pull request", skip = true },
  { message = "^Merge branch", skip = true },
  
  # Skip CI related commits globally (both [ci] suffix and (ci) scope)
  { message = "\\[ci\\]", skip = true },
  { message = "\\(ci\\):", skip = true },

  # Primary categories
  { message = "^feat", group = "<!-- 0 -->âœ¨ New Features" },
  { message = "^fix", group = "<!-- 1 -->ğŸ”§ Bug Fixes" },
  
  # GUI-specific
  { message = "^ui", group = "<!-- 2 -->ğŸ¨ User Interface" },
  { message = "^ux", group = "<!-- 2 -->ğŸ¨ User Interface" },
  
  # Documentation
  { message = "^docs", group = "<!-- 3 -->ğŸ“– Documentation" },
  
  # Performance & Quality
  { message = "^perf", group = "<!-- 4 -->âš¡ Performance Improvements" },
  { message = "^refactor", group = "<!-- 5 -->â™»ï¸ Code Refactoring" },
  
  # Testing & Infrastructure
  { message = "^test", skip = true },
  { message = "^ci", skip = true },
  { message = "^build", skip = true },
  
  # Maintenance
  { message = "^chore\\(release\\)", skip = true },
  { message = "^ğŸš€ Release", skip = true },
  { message = "^chore\\(deps\\)", group = "<!-- 8 -->ğŸ“¦ Dependencies" },
  { message = "^chore", group = "<!-- 9 -->ğŸ§¹ Maintenance" },
  
  # Security & Critical
  { body = ".*security", group = "<!-- 10 -->ğŸ”’ Security" },
  { message = "^security", group = "<!-- 10 -->ğŸ”’ Security" },
  
  # Style
  { message = "^style", skip = true },  # Skip pure style commits
  
  # Reverts
  { message = "^revert", group = "<!-- 11 -->âª Reverted Changes" },
]

# -----------------------------------------------------------------------------
# Additional Settings
# -----------------------------------------------------------------------------
filter_commits = false
protect_breaking_commits = true

# -----------------------------------------------------------------------------
# Link Parsers
# -----------------------------------------------------------------------------
# Auto-link issue numbers and RFC references to GitHub
link_parsers = [
  { pattern = "#(\\d+)", href = "https://github.com/Hapfel1/er-save-manager/issues/$1" },
  { pattern = "RFC-(\\d+)", href = "https://github.com/Hapfel1/er-save-manager/discussions/$1" },
]
